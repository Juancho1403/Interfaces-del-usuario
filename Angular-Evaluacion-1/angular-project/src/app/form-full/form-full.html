<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
  rel="stylesheet"
  integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT"
  crossorigin="anonymous"
/>

<!-- Google Web Fonts -->
<link rel="preconnect" href="https://fonts.gstatic.com" />
<link
  href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
  rel="stylesheet"
/>

<!-- Font Awesome -->
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
  rel="stylesheet"
/>

<!-- Libraries Stylesheet -->
<!-- <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet"> -->
<link
  href="../../../public/lib/owlcarousel/assets/owl.carousel.min.css"
  rel="stylesheet"
/>
<!-- <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" /> -->
<link
  href="../../../public/lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css"
  rel="stylesheet"
/>

<!-- Customized Bootstrap Stylesheet -->
<!-- <link href="css/style.css" rel="stylesheet"> -->
<link href="../../../public/css/style.css" rel="stylesheet" />

<link href="../../../public/css/new-form-style.css" rel="stylesheet" />

<div class="container-fluid">
  <div class="row">
    <!-- Columna izquierda - Editor -->
    <div class="col-md-6">
      <div class="form-section">
        <div class="editor-container">
          <div class="module-tabs">
            <button class="tab-btn active" data-tab="colors">Colores</button>
            <button class="tab-btn" data-tab="fonts">Fuentes</button>
          </div>

          <!-- Módulo de Colores -->
          <form [formGroup]="colorForm" (ngSubmit)="onSubmit()">
          
          <div id="colors" class="module-content active">
            <h3 class="section-title">Personalización de Colores</h3>
            <div class="mb-3">
              <label class="form-label">Nombre de la paleta</label>
              <input type="text" class="form-control" formControlName="nombre_paleta">
              @if (colorForm.get('nombre_paleta')?.invalid && colorForm.get('nombre_paleta')?.touched) {
                <div class="text-danger">
                    El nombre es requerido
                </div>
              }
            </div>
            <div class="form-group">
              <label class="form-label">Color Primario (60%)</label>
              <span class="ms-2">{{ colorForm.get('color_primario')?.value }}</span>
              <input
                type="color"
                class="form-control"
                id="colorPrimary"
                formControlName="color_primario"
              />
            </div>

            <div class="form-group">
              <label class="form-label">Color Secundario (30%)</label>
              <span class="ms-2">{{ colorForm.get('color_secundario')?.value }}</span>
              <input
                type="color"
                class="form-control"
                id="colorSecondary"
                formControlName="color_secundario"
              />
            </div>

            <div class="form-group">
              <label class="form-label">Color de Acento (10%)</label>
              <span class="ms-2">{{ colorForm.get('color_terciario')?.value }}</span>
              <input
                type="color"
                class="form-control"
                id="colorAccent"
                value="#4895ef"
                formControlName="color_terciario"
              />
            </div>

            <div class="form-group">
              <label class="form-label">Color de Texto</label>
              <span class="ms-2">{{ colorForm.get('color_texto')?.value }}</span>
              <input
                type="color"
                class="form-control"
                id="colorText"
                value="#2b2d42"
                formControlName="color_texto"
              />
            </div>

            <div class="form-group">
              <label class="form-label">Color de Fondo</label>
              <span class="ms-2">{{ colorForm.get('color_texto')?.value }}</span>
              <input
                type="color"
                class="form-control"
                id="colorBackground"
                value="#f8f9fa"
                formControlName="color_fondo"
              />
            </div>
            <div class="d-flex justify-content-center align-items-center">
                <button type="submit" class="btn btn-primary py-md-3 px-md-5 mt-2">
                  {{ isEditing ? 'Actualizar' : ' Crear Paleta ' }}
                </button>
                
                @if (isEditing) {
                    <button type="button" class="btn btn-secondary py-md-3 px-md-5 mt-2 ml-4" (click)="initForm()">
                        Cancelar
                    </button>
                }
              </div>
              <!-- Mensajes de error -->
              @if (errorMessage) {
                <div class="alert alert-danger py-md-3 px-md-5 mt-5 ">
                    {{ errorMessage }}
                </div>
              }
          </div>
          </form>

          <!-- Módulo de Fuentes -->
          <div id="fonts" class="module-content">
            <h3 class="section-title">Personalización de Tipografía</h3>

            <div class="form-group">
              <label class="form-label">Tamaño de Títulos (px)</label>
              <input
                type="number"
                class="form-control"
                id="titleSize"
                min="20"
                max="60"
                value="40"
              />
            </div>

            <div class="form-group">
              <label class="form-label">Tamaño de Subtítulos (px)</label>
              <input
                type="number"
                class="form-control"
                id="subtitleSize"
                min="16"
                max="40"
                value="28"
              />
            </div>

            <div class="form-group">
              <label class="form-label">Tamaño de Párrafos (px)</label>
              <input
                type="number"
                class="form-control"
                id="paragraphSize"
                min="12"
                max="24"
                value="16"
              />
            </div>

            <div class="form-group">
              <label class="form-label">Fuente Principal (.ttf)</label>
              <div class="file-upload">
                <div class="file-label">Seleccionar archivo .ttf</div>
                <input type="file" accept=".ttf" />
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Fuente Secundaria (.ttf)</label>
              <div class="file-upload">
                <div class="file-label">Seleccionar archivo .ttf</div>
                <input type="file" accept=".ttf" />
              </div>
            </div>
              <div class="container">
                <div class="row">
                  <div class="d-flex justify-content-center align-items-center">
                    <button class="btn btn-primary py-md-3 px-md-5 mt-2"> Guardar Cambios </button>
                  </div>
                </div>
              </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Columna derecha - Vista Previa -->
    <div class="col-md-6 preview-section" id="previewSection">
      <div class="preview-card" id="previewSection">
        <p id="textSec">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            class="bi bi-info-circle-fill"
            viewBox="0 0 16 16"
          >
            <path
              d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2"
            />
          </svg>
          - Bg - div - texto - texto sec - resaltado
        </p>
        <div class="service-item bg-white text-center mb-2 py-5 px-4">
          <i class="fas fa-route fa-2x mx-auto mb-4"></i>
          <h3 class="mb-3">Travel Guide</h3>
          <p class="m-0 fs-5">
            Justo sit justo eos amet tempor amet clita amet ipsum eos elitr.
            Amet lorem est amet labore eos sit elitr. Diam dolor et sit dolor
            eos lorem. Ipsum diam dolor magna.
          </p>
        </div>
      </div>

      <div class="preview-card">
        <h3 class="preview-subtitle">Configuración Actual</h3>

        <div class="current-settings">
          <div class="setting-badge">
            Títulos: <span id="previewTitleSize">40px</span>
          </div>
          <div class="setting-badge">
            Subtítulos: <span id="previewSubtitleSize">28px</span>
          </div>
          <div class="setting-badge">
            Párrafos: <span id="previewParagraphSize">16px</span>
          </div>
          <div class="setting-badge">Fuente: Roboto</div>
          <div class="setting-badge">Títulos: Montserrat</div>
        </div>

        <div class="mt-4">
          <h4>Paleta de Colores</h4>
          <div class="color-palette">
            <div
              class="color-option"
              style="background-color: var(--color-primary)"
            ></div>
            <div
              class="color-option"
              style="background-color: var(--color-secondary)"
            ></div>
            <div
              class="color-option"
              style="background-color: var(--color-accent)"
            ></div>
            <div
              class="color-option"
              style="background-color: var(--color-text)"
            ></div>
            <div
              class="color-option"
              style="background-color: var(--color-background)"
            ></div>
          </div>

          <div class="mt-4">
            <div class="d-flex justify-content-between mb-2">
              <span>Primario</span>
              <span>60% uso</span>
            </div>
            <div class="progress" style="height: 20px">
              <div
                class="progress-bar"
                style="width: 60%; background-color: var(--color-primary)"
              ></div>
            </div>
          </div>

          <div class="mt-3">
            <div class="d-flex justify-content-between mb-2">
              <span>Secundario</span>
              <span>30% uso</span>
            </div>
            <div class="progress" style="height: 20px">
              <div
                class="progress-bar"
                style="width: 30%; background-color: var(--color-secondary)"
              ></div>
            </div>
          </div>

          <div class="mt-3">
            <div class="d-flex justify-content-between mb-2">
              <span>Acento</span>
              <span>10% uso</span>
            </div>
            <div class="progress" style="height: 20px">
              <div
                class="progress-bar"
                style="width: 10%; background-color: var(--color-accent)"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Lista de paletas -->
  <div class="card">
    <div class="card-header">
      Paletas Existentes
    </div>

    @if (isLoading) {
        <div class="card-body text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-2">Cargando paletas...</p>
        </div>
}

@if (!isLoading && colors.length === 0) {
    <div class="card-body">
        <p class="text-center">No se encontraron paletas de colores.</p>
    </div>

}

@if (!isLoading && colors.length!=0) {
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Seleccionar</th>
              <th>Nombre</th>
              <th>Primario</th>
              <th>Secundario</th>
              <th>Terciario</th>
              <th>Texto</th>
              <th>Fondo</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            @for (color of colors; track $index) {
                <tr>
                  <td>
                    <input 
                      type="radio" 
                      name="activePalette" 
                      [checked]="selectedPaletteId === color.id"
                      (change)="selectPalette(color)"
                    >
                  </td>

              <td>{{ color.nombre_paleta }}</td>

              <td>
                <div class="d-flex align-items-center">
                  <div class="color-preview me-2" [style.background-color]="color.color_primario"></div>
                  {{ color.color_primario }}
                </div>
              </td>
              
              <td>
                <div class="d-flex align-items-center">
                  <div class="color-preview me-2" [style.background-color]="color.color_secundario"></div>
                  {{ color.color_secundario }}
                </div>
              </td>
              
              <td>
                <div class="d-flex align-items-center">
                  <div class="color-preview me-2" [style.background-color]="color.color_terciario"></div>
                  {{ color.color_terciario }}
                </div>
              </td>
              
              <td>
                <div class="d-flex align-items-center">
                  <div class="color-preview me-2" [style.background-color]="color.color_texto"></div>
                  {{ color.color_texto }}
                </div>
              </td>
              
              <td>
                <div class="d-flex align-items-center">
                  <div class="color-preview me-2" [style.background-color]="color.color_fondo"></div>
                  {{ color.color_fondo }}
                </div>
              </td>
              
              <td>
                <div class="btn-group">
                  <button class="btn btn-sm btn-warning me-1" (click)="selectColor(color)">
                    <i class="bi bi-pencil"></i> Editar
                  </button>
                  <button class="btn btn-sm btn-danger" (click)="deleteColor(color.id)">
                    <i class="bi bi-trash"></i> Eliminar
                  </button>
                </div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
}

  </div>

</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Cambio de módulos
    const tabBtns = document.querySelectorAll(".tab-btn");
    const moduleContents = document.querySelectorAll(".module-content");

    tabBtns.forEach((btn) => {
      btn.addEventListener("click", function () {
        tabBtns.forEach((b) => b.classList.remove("active"));
        this.classList.add("active");

        moduleContents.forEach((content) => content.classList.remove("active"));
        const tabId = this.getAttribute("data-tab");
        document.getElementById(tabId).classList.add("active");
      });
    });

    // Controladores de inputs de color
    const colorPrimary = document.getElementById("colorPrimary");
    const colorSecondary = document.getElementById("colorSecondary");
    const colorAccent = document.getElementById("colorAccent");
    const colorText = document.getElementById("colorText");
    const colorBackground = document.getElementById("colorBackground");

    colorPrimary.addEventListener("input", function () {
      document.documentElement.style.setProperty("--color-primary", this.value);
    });

    colorSecondary.addEventListener("input", function () {
      document.documentElement.style.setProperty(
        "--color-secondary",
        this.value
      );
    });

    colorAccent.addEventListener("input", function () {
      document.documentElement.style.setProperty("--color-accent", this.value);
    });

    colorText.addEventListener("input", function () {
      document.documentElement.style.setProperty("--color-text", this.value);
    });

    colorBackground.addEventListener("input", function () {
      document.documentElement.style.setProperty(
        "--color-background",
        this.value
      );
    });

    // Controladores de tamaño de fuente
    const titleSize = document.getElementById("titleSize");
    const subtitleSize = document.getElementById("subtitleSize");
    const paragraphSize = document.getElementById("paragraphSize");

    titleSize.addEventListener("input", function () {
      document.documentElement.style.setProperty(
        "--font-size-title",
        this.value + "px"
      );
      document.getElementById("previewTitleSize").textContent =
        this.value + "px";
    });

    subtitleSize.addEventListener("input", function () {
      document.documentElement.style.setProperty(
        "--font-size-subtitle",
        this.value + "px"
      );
      document.getElementById("previewSubtitleSize").textContent =
        this.value + "px";
    });

    paragraphSize.addEventListener("input", function () {
      document.documentElement.style.setProperty(
        "--font-size-paragraph",
        this.value + "px"
      );
      document.getElementById("previewParagraphSize").textContent =
        this.value + "px";
    });

    // Controladores de archivos de fuentes
    const fontFiles = document.querySelectorAll('input[type="file"]');
    fontFiles.forEach((fileInput) => {
      fileInput.addEventListener("change", function () {
        const fileLabel = this.previousElementSibling;
        if (this.files.length > 0) {
          fileLabel.textContent = this.files[0].name;
          fileLabel.style.backgroundColor = "#d4edda";
          fileLabel.style.color = "#155724";
        } else {
          fileLabel.textContent = "Seleccionar archivo .ttf";
          fileLabel.style.backgroundColor = "";
          fileLabel.style.color = "";
        }
      });
    });

    // Botón Guardar
    document.querySelector(".save-btn").addEventListener("click", function () {
      const btn = this;
      btn.textContent = "Guardando...";
      btn.disabled = true;

      setTimeout(() => {
        btn.textContent = "¡Cambios guardados!";
        btn.style.backgroundColor = "#28a745";

        setTimeout(() => {
          btn.textContent = "Guardar Cambios";
          btn.style.backgroundColor = "#20c997";
          btn.disabled = false;
        }, 2000);
      }, 1000);
    });
  });
</script>
